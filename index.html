<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Bubble Pop Garden</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: #f9f4ff;
      overflow: hidden;
      touch-action: manipulation;
    }
    #landing, #game-container, #store, #levels {
      width: 100vw;
      height: 100vh;
      display: none;
    }
    #landing {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(to bottom, #a8edea, #fed6e3);
    }
    .title {
      font-size: 2.5rem;
      color: #5a3d7a;
      margin-bottom: 2rem;
      text-align: center;
    }
    .btn {
      width: 200px;
      padding: 15px 0;
      margin: 10px;
      border: none;
      border-radius: 30px;
      font-size: 1.2rem;
      font-weight: bold;
      color: white;
      background: #ff8a98;
      cursor: pointer;
      user-select: none;
    }
    #game-container {
      position: relative;
      background: #f9f4ff;
      overflow: hidden;
    }
    .bubble {
      position: absolute;
      border-radius: 50%;
      cursor: pointer;
      will-change: transform;
      user-select: none;
    }
    #ui {
      position: absolute;
      top: 10px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 10px;
      z-index: 100;
    }
    #coins, #back-btn {
      background: rgba(255,255,255,0.7);
      padding: 5px 10px;
      border-radius: 20px;
      font-weight: bold;
      user-select: none;
    }
    #back-btn {
      cursor: pointer;
    }
    /* Store Container */
    #store {
      display: none;
      width: 100vw;
      height: 100vh;
      padding: 20px;
      background: linear-gradient(to bottom, #a8edea, #fed6e3);
      overflow-y: auto;
      box-sizing: border-box;
      -webkit-overflow-scrolling: touch; /* smooth scroll on iOS */
    }

    /* Store Header */
    .store-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      color: #5a3d7a;
    }

    /* Store Items Container */
    #store-items > div {
      background: white;
      border-radius: 15px;
      padding: 15px 20px;
      margin-bottom: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      font-family: 'Comic Sans MS', cursive, sans-serif;
      color: #5a3d7a;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    /* Item Name and Price */
    #store-items h3 {
      margin: 0;
      font-size: 1.2rem;
      flex: 1 1 60%;
    }

    #store-items p {
      margin: 0;
      font-weight: bold;
      flex: 1 1 30%;
      text-align: right;
    }

    /* Buttons in Store */
    .buy-btn, .equip-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      min-width: 100px;
      flex-shrink: 0;
      color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.15);
      margin-left: 10px;
      user-select: none;
    }

    /* Buy Button */
    .buy-btn {
      background: #ff8a98;
    }
    .buy-btn:hover:not(:disabled) {
      background: #ff6070;
    }
    .buy-btn:disabled {
      background: #f7b4bd;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Equip Button */
    .equip-btn {
      background: #8a7fca;
    }
    .equip-btn:hover {
      background: #6e60b8;
    }
    .equip-btn.equipped {
      background: #5a3d7a;          /* A rich purple */
      color: #fff;                  /* White text */
      cursor: default;
      box-shadow: 0 4px 12px rgba(90, 61, 122, 0.6); /* glow effect */
      border: 2px solid #d1c4e9;   /* subtle border */
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    .equip-btn.equipped:hover {
      background: #5a3d7a;  /* no hover change */
      box-shadow: 0 4px 14px rgba(90, 61, 122, 0.8); /* stronger glow on hover */
    }

    /* Store Back Button */
    #store-back-btn {
      width: 100%;
      padding: 15px 0;
      background: #5a3d7a;
      color: white;
      border: none;
      border-radius: 30px;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      transition: background-color 0.3s ease;
      user-select: none;
      margin-top: 20px;
    }

    #store-back-btn:hover {
      background: #412a57;
    }

    /* Levels Page */
    #levels {
      display: none;
      width: 100vw;
      height: 100vh;
      padding: 20px;
      background: linear-gradient(to bottom, #a8edea, #fed6e3);
      overflow-y: auto;
      box-sizing: border-box;
      -webkit-overflow-scrolling: touch;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      color: #5a3d7a;
    }
    #levels h2 {
      margin-bottom: 15px;
    }
    .levels-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .level-btn {
      padding: 15px 10px;
      border-radius: 20px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #d3cce3;
      color: #5a3d7a;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease;
      border: none;
    }
    .level-btn:hover:not(:disabled) {
      background: #b39ddb;
      color: #3c2f63;
    }
    .level-btn.locked {
      background: #bbb;
      color: #666;
      cursor: not-allowed;
      box-shadow: none;
    }
    .level-goal {
      font-size: 0.9rem;
      margin-top: 5px;
      font-weight: normal;
    }
    #levels-back-btn {
      width: 100%;
      padding: 15px 0;
      background: #5a3d7a;
      color: white;
      border: none;
      border-radius: 30px;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      transition: background-color 0.3s ease;
      user-select: none;
      margin-top: 20px;
    }
    #levels-back-btn:hover {
      background: #412a57;
    }

    
  </style>
</head>
<body>
  <div id="landing">
    <h1 class="title">Bubble Pop Garden</h1>
    <button class="btn" id="play-btn">PLAY</button>
    <button class="btn" id="levels-btn">LEVELS</button>
    <button class="btn" id="store-btn">STORE</button>
  </div>

  <div id="game-container">
    <div id="ui">
      <div id="back-btn">← Back</div>
      <div id="coins">0</div>
    </div>
  </div>

  <div id="store">
    <div class="store-header">
      <h2>Store</h2>
      <div id="store-coins">Coins: 0</div>
    </div>
    <div id="store-items"></div>
    <button id="store-back-btn" class="btn">← Back</button>
  </div>

  <div id="levels">
    <h2>Levels</h2>
    <div class="levels-grid" id="levels-grid"></div>
    <button id="levels-back-btn" class="btn">← Back</button>
  </div>
  <!-- Notification banner -->
<div id="notification-banner" style="
position: fixed;
top: 10px;
left: 50%;
transform: translateX(-50%);
background-color: #4267B2;
color: white;
padding: 12px 24px;
border-radius: 20px;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
font-size: 1rem;
box-shadow: 0 4px 12px rgba(66, 103, 178, 0.7);
opacity: 0;
pointer-events: none;
transition: opacity 0.5s ease;
z-index: 9999;
max-width: 90%;
text-align: center;
user-select: none;
"></div>

<script>
  // Safe parse helper for arrays in localStorage
  function safeParseArray(key, fallback) {
    try {
      const data = JSON.parse(localStorage.getItem(key));
      return Array.isArray(data) ? data : fallback;
    } catch {
      return fallback;
    }
  }

  const gameState = {
    coins: parseInt(localStorage.getItem('coins')) || 0,
    unlockedLevels: safeParseArray('unlockedLevels', [1]), // level 1 unlocked by default
    purchasedItems: safeParseArray('purchasedItems', []),
    activeCustomizations: safeParseArray('activeCustomizations', []),
    currentLevel: 1,
    activeBubbles: []
  };

  const levels = [
    { id: 1, goal: 50, bubbleCount: 5, speed: 5 },
    { id: 2, goal: 100, bubbleCount: 7, speed: 4 },
    { id: 3, goal: 150, bubbleCount: 9, speed: 3.5 },
    { id: 4, goal: 200, bubbleCount: 11, speed: 3 },
    { id: 5, goal: 250, bubbleCount: 13, speed: 2.5 },
    { id: 6, goal: 300, bubbleCount: 15, speed: 2 }
  ];

  const landingPage = document.getElementById('landing');
  const gameContainer = document.getElementById('game-container');
  const storePage = document.getElementById('store');
  const levelsPage = document.getElementById('levels');
  const levelsGrid = document.getElementById('levels-grid');

  document.getElementById('play-btn').onclick = () => showGameScreen(gameState.currentLevel);
  document.getElementById('levels-btn').onclick = () => showLevelsScreen();
  document.getElementById('store-btn').onclick = () => showStoreScreen();
  document.getElementById('back-btn').onclick = () => showLandingScreen();
  document.getElementById('store-back-btn').onclick = () => showLandingScreen();
  document.getElementById('levels-back-btn').onclick = () => showLandingScreen();

  function showLandingScreen() {
    landingPage.style.display = 'flex';
    gameContainer.style.display = storePage.style.display = levelsPage.style.display = 'none';
    clearBubbles();
  }

  function showGameScreen(levelId) {
    landingPage.style.display = storePage.style.display = levelsPage.style.display = 'none';
    gameContainer.style.display = 'block';
    gameState.currentLevel = levelId;
    startLevel(levelId);
  }

  function showStoreScreen() {
    landingPage.style.display = gameContainer.style.display = levelsPage.style.display = 'none';
    storePage.style.display = 'block';
    renderStoreItems();
  }

  function showLevelsScreen() {
    landingPage.style.display = gameContainer.style.display = storePage.style.display = 'none';
    levelsPage.style.display = 'block';
    renderLevelButtons();
  }

  function renderLevelButtons() {
    levelsGrid.innerHTML = '';
    levels.forEach(level => {
      const isUnlocked = gameState.unlockedLevels.includes(level.id);
      const btn = document.createElement('button');
      btn.className = 'level-btn ' + (isUnlocked ? 'unlocked' : 'locked');
      btn.disabled = !isUnlocked;
      btn.innerHTML = `
        <span>Level ${level.id}</span>
        <span class="level-goal">Goal: ${level.goal}</span>
      `;
      if (isUnlocked) {
        btn.onclick = () => showGameScreen(level.id);
      }
      levelsGrid.appendChild(btn);
    });
  }

  function renderStoreItems() {
    const storeItems = [
      { id: 1, name: "Rainbow Bubble", price: 100 },
      { id: 2, name: "Star Shape", price: 200 },
      { id: 3, name: "Golden Bubbles", price: 300 }
    ];

    const container = document.getElementById('store-items');
    container.innerHTML = '';
    document.getElementById('store-coins').textContent = `Coins: ${gameState.coins}`;

    storeItems.forEach(item => {
      const isPurchased = gameState.purchasedItems.includes(item.id);
      const isActive = gameState.activeCustomizations.includes(item.id);
      const div = document.createElement('div');
      div.className = 'store-item';
      div.innerHTML = `
        <h3>${item.name}</h3>
        <p>Price: ${item.price} coins</p>
        <button class="${isPurchased ? (isActive ? 'equip-btn equipped' : 'equip-btn') : 'buy-btn'}" data-id="${item.id}">
          ${isPurchased ? (isActive ? 'Equipped' : 'Equip') : 'Buy'}
        </button>
      `;
      const btn = div.querySelector('button');
      btn.onclick = () => {
        if (!isPurchased && gameState.coins >= item.price) {
          gameState.coins -= item.price;
          gameState.purchasedItems.push(item.id);
        } else if (isPurchased) {
          toggleCustomization(item.id);
        }
        updateCoinsDisplay();
        renderStoreItems();
        saveGameState();
      };
      container.appendChild(div);
    });
  }

  function toggleCustomization(id) {
    const idx = gameState.activeCustomizations.indexOf(id);
    if (idx === -1) gameState.activeCustomizations.push(id);
    else gameState.activeCustomizations.splice(idx, 1);
    saveGameState();
  }

  function startLevel(id) {
    clearBubbles();
    updateCoinsDisplay();
    const level = levels.find(l => l.id === id);
    if (!level) return;
    for (let i = 0; i < level.bubbleCount; i++) {
      createBubble(level.speed);
    }
  }

  function createBubble(speed) {
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    const size = 30 + Math.random() * 40;
    const x = Math.random() * (window.innerWidth - size);
    bubble.style.width = `${size}px`;
    bubble.style.height = `${size}px`;
    bubble.style.left = `${x}px`;
    bubble.style.top = `${window.innerHeight}px`;
    applyCustomizations(bubble);
    const duration = speed + Math.random() * 2;
    bubble.style.transition = `top ${duration}s linear`;
    bubble.onclick = () => {
      bubble.remove();
      gameState.activeBubbles = gameState.activeBubbles.filter(b => b !== bubble);
      gameState.coins += Math.floor(size / 10);
      updateCoinsDisplay();
      checkLevelCompletion();
      ensureMinimumBubbles();
    };
    gameContainer.appendChild(bubble);
    gameState.activeBubbles.push(bubble);
    setTimeout(() => { bubble.style.top = `-${size}px`; }, 10);
    setTimeout(() => {
      if (bubble.parentNode) {
        bubble.remove();
        gameState.activeBubbles = gameState.activeBubbles.filter(b => b !== bubble);
        ensureMinimumBubbles();
      }
    }, duration * 1000);
  }

  function ensureMinimumBubbles() {
    const level = levels.find(l => l.id === gameState.currentLevel);
    const needed = level.bubbleCount - gameState.activeBubbles.length;
    for (let i = 0; i < needed; i++) {
      createBubble(level.speed);
    }
  }

  function applyCustomizations(bubble) {
    if (gameState.activeCustomizations.includes(1)) {
      bubble.style.background = `linear-gradient(45deg, hsl(${Math.random() * 360}, 70%, 70%), hsl(${Math.random() * 360}, 70%, 70%))`;
    } else {
      bubble.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 70%)`;
    }
    if (gameState.activeCustomizations.includes(2)) {
      bubble.style.borderRadius = '0';
    }
    if (gameState.activeCustomizations.includes(3)) {
      bubble.style.backgroundColor = '#FFD700';
    }
  }

  function checkLevelCompletion() {
    const currentLevelData = levels.find(l => l.id === gameState.currentLevel);
    if (gameState.coins >= currentLevelData.goal) {
      unlockNextLevel(gameState.currentLevel);
    }
  }

  function unlockNextLevel(currentLevelId) {
  const nextLevel = currentLevelId + 1;
  if (!gameState.unlockedLevels.includes(nextLevel) && nextLevel <= levels.length) {
    gameState.unlockedLevels.push(nextLevel);
    saveGameState();

    const banner = document.getElementById('notification-banner');
    banner.textContent = `🎉 Level ${currentLevelId} completed! Level ${nextLevel} unlocked!`;
    banner.style.opacity = '1';
    banner.style.pointerEvents = 'auto';

    // After 1.5 seconds, fade out
    setTimeout(() => {
      banner.style.opacity = '0';
      banner.style.pointerEvents = 'none';
    }, 1500);
  }
}


  function updateCoinsDisplay() {
    document.getElementById('coins').textContent = gameState.coins;
    if (storePage.style.display === 'block') {
      document.getElementById('store-coins').textContent = `Coins: ${gameState.coins}`;
    }
    localStorage.setItem('coins', gameState.coins);
  }

  function clearBubbles() {
    gameState.activeBubbles.forEach(b => b.remove());
    gameState.activeBubbles = [];
  }

  function saveGameState() {
    localStorage.setItem('coins', gameState.coins);
    localStorage.setItem('unlockedLevels', JSON.stringify(gameState.unlockedLevels));
    localStorage.setItem('purchasedItems', JSON.stringify(gameState.purchasedItems));
    localStorage.setItem('activeCustomizations', JSON.stringify(gameState.activeCustomizations));
  }

  // Start on landing screen
  showLandingScreen();
</script>
</body>
</html>
